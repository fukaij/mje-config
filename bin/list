#!/bin/sh
#
# list - List locked, snapped, and new files in directories
# Written by Martin Ebourne, Started 20/08/99
#
# $Id: list,v 1.5 1999/09/08 13:36:03 martine Exp $

base=`pwd`

for dir in . `find . -name '.VCS' -print | sed -e 's:^./\(.*/\).VCS$:\1:' -e '/VCS/d' | sort`
do
  if [ "$dir" = "." ]
  then
    dir=./
  fi

  awk '
BEGIN { FS="=" }
$1=="lock" { print "L", dir $2 }
$1=="snap" { print "S", dir $2 }
' dir=$dir $dir/.VCS

  if [ "$1" = "-n" ]
  then

    cd $dir
  
    files=""
    for f in * .*
    do
      case $f in
  	.|..|.VCS|*~|*.bak|*.log|*.out|*.vcsbak|.newbld|TAGS)
  	  # Ignore these types of files as temporary or backups
  	  ;;
  
  	*)
  	  if [ ! -h "$f" -a -f "$f" ]
  	  then
  	    files="$files$f\n"
  	  fi
  	  ;;
  	esac
    done

    if [ -n "$files" ]
    then
      vcfiles=`awk '
BEGIN { FS="=" }
$1=="lock" { print $2 }
$1=="snap" { print $2 }
' .VCS`
      echo "$files$vcfiles" | sort | uniq -u | grep -v '^$' | sed "s:^:N $dir:"
    fi

    cd $base

  fi
done
