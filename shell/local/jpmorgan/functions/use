#eval compdef -n _parse_opts use
# ZSH function file
# Select an environment to run in
#
# $Id$

local basedirprefix1="/export1/home/odyssey/"
local basedirprefix2="/export1/home/sts/"

local -a environments
environments=($basedirprefix1* $basedirprefix2*)
environments=(${${environments#$basedirprefix1}#$basedirprefix2})

local -A opts
parse_opts - opts -- "$argv[@]" <<'EOF' || return 1
Description:
Select an environment to run in

Usage:
makecr [options] <environment>

Options:
  -h, --help			Provide this help
				# --help | -h * excludes=*

Arguments:
  <environment>			The environment to select
				# environment : values=environments
EOF

sqluse $opts[environment] qm -s
xterm_name=$opts[environment]

if [[ -d $basedirprefix1$opts[environment] ]]
then
  export ODYSSEY=$basedirprefix1$opts[environment]
else
  export ODYSSEY=$basedirprefix2$opts[environment]
fi

# Set environment dependent variables
local varname="" varvalue=""
while IFS="=" read varname varvalue
do
  if [[ $varname == "OSAGENT_PORT" ]]
  then
    typeset -Ugx $varname="$varvalue";
  fi
done < $ODYSSEY/registry/env.reg
