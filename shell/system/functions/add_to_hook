#eval compdef -n _parse_opts add_to_hook
# ZSH function file
# Add command to function if not already present. Makes a function
# usable as a hook a al emacs
#
# $Id: add_to_hook,v 1.4 2001/07/31 17:17:12 mebourne Exp $

local -a args
args=($argv[*])
local -A opts
parse_opts args opts - 2 <<'EOF' || return 1
add_to_hook [options] <function-name> <command> ...
  -h, --help			Provide this help
				# help | h
EOF

local funcname="$args[1]" command="$args[2,-1]"

if [[ -z $functions[$funcname] ]]
then
  functions[$funcname]="setopt noxtrace
"
fi

functions[$funcname]="${functions[$funcname]//$command}
$command
"
