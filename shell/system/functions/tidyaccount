#eval compdef -n _parse_opts tidyaccount
# ZSH function file
# Tidy account up generally
#
# $Id: tidyaccount,v 1.10 2001/08/01 19:37:42 mebourne Exp $

local this
if [[ $0 == /* ]]
then
  this=$0
else
  this=$ZCONFIGDIR/system/functions/${0:t}
fi

local -a args
args=($argv[*])
local -A opts

opts[scheduleat]=$SCHEDTIME

parse_opts args opts <<'EOF' || return 1
Description:
Tidy account up generally

Usage:
tidyaccount [options]

Options:
  -h, --help			Provide this help
				# help | h
  -s <time>, --schedule-at=<time>
				Re-schedule job with 'at'
				# scheduleat = schedule-at | s = string
EOF

# Delete any core/backup/etc files not accessed in the last week
find $HOME -type f \( -name core -o -name '*~' -o -name '#*#' \) -atime +7 -print |
  xargs rm -f

# Delete any Emacs saves files older than 3 days
find $HOME -depth \( -type f -name '.saves-*' -mtime +3 -print \) \
	       -o \( -type d -prune \) |
  xargs rm -f

# Re-schedule job if requested
if [[ -n $opts[scheduleat] ]]
then
  echo source $this |
    SCHEDTIME=$opts[scheduleat] at $opts[scheduleat] 2>/dev/null
fi
