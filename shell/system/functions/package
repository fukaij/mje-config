# ZSH function file
# Load a package which is part of the configuration system
# Usage: package <package-name>
#
# $Id: package,v 1.3 2001/05/09 10:38:13 mebourne Exp $

local package=$1
local setupfile=$ZCONFIGDIR/package/$package/setup

if [[ -z $_package_loaded[(r)$package] ]]
then
  if [[ -r $setupfile ]]
  then
    [[ -n $ZCONFIGDEBUG ]] && echo "Loading package $package"

    # Define each package setup file into a function and call that. This gives much more
    # meaningful output when profiled
    local fn=_package_${package//\\//_}
    function $fn {
      . $setupfile
    }
    $fn
    unfunction $fn

    _package_loaded=($_package_loaded $package)
  else
    echo "Package $package does not exist" 1>&2
    return 1
  fi
else
  echo "Package $package already loaded" 1>&2
  return 1
fi
